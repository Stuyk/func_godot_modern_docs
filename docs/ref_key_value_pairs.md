FuncGodot Manual  

# Entity Key Value Pairs

## What Are Key Value Pairs?

Key Value Pairs are the most powerful aspect of FuncGodot. All of the _Class Properties_ set in a [FuncGodotFGDEntity](ref_fgd_resources.html#Entity) definition get added to the corresponding entity placed in the map editor.

Key Value Pairs are defined in a _FuncGodotFGDEntityClass_ resource's _Class Properties_ dictionary. A Class Property is defined with a key String and a value of many of the [Godot Variant Types](class_variant.md) (see [Property Types](#PropertyTypes) below for a full list). The value set becomes both the default value and the Variant type the FuncGodotMap applies to that property on map build.

![](./images/ref_kvp_classprops.png)

Additionally, you can define a property description. With the exception of [Choices](#Choices) and [Bit Flags](#BitFlags), property descriptions are created by matching a key from _Class Properties_ to the _Class Property Descriptions_ dictionary and setting a **String** value for the description.

![](./images/ref_kvp_classdescs.png)

The result as it appears in TrenchBroom:

![](./images/ref_kvp_classprops_tb.png)

If you plan on using J.A.C.K. you may want to use the descriptions as proper names for the keys rather than actual descriptions. The same entity's properties as they appear in J.A.C.K.:

![](./images/ref_kvp_classprops_jack1.png) ![](./images/ref_kvp_classprops_jack2.png)

Once the corresponding node is generated by a [FuncGodotMap](ref_func_godot_map.md), these key value pairs are then applied to the generated node's _func\_godot\_properties_ dictionary. Additionally, if you add undefined key value pairs in your map editor, these too will be added to your node's _func\_godot\_properties_ dictionary.

> _NOTE: Entity keys that are not given values will have their default values applied to the generated node's_ func\_godot\_properties _dictionary._

  

## Applying Key Values

It's pretty easy to apply entity key value pairs to nodes generated by FuncGodot. You have one property and two methods that you can use: the Dictionary `func_godot_properties`, the method `_func_godot_apply_properties(entity_properties: Dictionary)`, and the deferred method `_func_godot_build_complete()`.

After the entity is built, FuncGodot will check if the entity contains a `func_godot_properties` Dictionary, and if it exists it will apply the translated key value pairs as a Dictionary to this variable. In order for the application to persist at Runtime or after closing your scene, you'll need to make sure the variable is an `@export` variable.

Use `_func_godot_apply_properties` to apply your key value pairs to your node, as they are passed through the `_func_godot_properties` argument in the function.

`_func_godot_build_complete` is a deferred call that happens after every entity has called `_func_godot_apply_properties`, making it safe to reference any nodes generated during `_func_godot_apply_properties`.

![FuncGodotMap GDScript method showing application of 'func_godot_properties' and callback of '_func_godot_apply_properties' and '_func_godot_build_complete'.](./images/guide_fgd_apply_props.png)

You are allowed to limit yourself to only the application methods you're interested in. Mix and match these options as you see fit for your entities.

  

## Property Types

FuncGodot supports many of the [Godot Variant types](https://docs.godotengine.org/en/stable/classes/class_%40globalscope.html#enum-globalscope-variant-type). Consult the [key values section of the FGD page on the Valve Developer Wiki](https://developer.valvesoftware.com/wiki/FGD#key values) for more information on FGD value types.

  

|     |     |     |
| --- | --- | --- |
| Godot Variant Type | FGD Value Type | Notes |
| [Int](class_int.md) | integer |     |
| [Float](class_float.md) | float |     |
| [String](class_string.md) | string |     |
| [StringName](class_string.md) | string |     |
| [Bool](class_bool.md) | choices | Automatically sets up options "No" and "Yes" with values "0" and "1" respectively. |
| [Vector2](class_vector2.md) | string | Vector2 key values are represented as string "X Y". Can accept floating point values. |
| [Vector2i](class_vector2i.md) | string | Vector2i key values are represented as string "X Y". Can only accept integer values. |
| [Vector3](class_vector3.md) | string | Vector3 key values are represented as string "X Y Z". Can accept floating point values. |
| [Vector3i](class_vector3i.md) | string | Vector3i key values are represented as string "X Y Z". Can only accept integer values. |
| [Vector4](class_vector4.md) | string | Vector4 key values are represented as string "W X Y Z". Can accept floating point values. |
| [Vector4i](class_vector4i.md) | string | Vector4i key values are represented as string "W X Y Z". Can only accept integer values. |
| [Color](class_color.md) | color255 | Color key values are represented as "R G B", with each value being from 0 to 255. Some map editors may offer a color picker.  <br>Alpha is always set to 1.0. If alpha requires specification, use an additional float property. |
| [Dictionary](class_dictionary.md) | choices | Returns an [Int](class_int.md) or [String](class_string.md) on map build.  <br>Dictionaries are a special property case. See the [Choices](#Choices) section for more information. |
| [Array](class_array.md) | flags | Returns an [Int](class_int.md) on map build to be used as a bit mask.  <br>Somewhat complicated to set up and only flexibly supported in TrenchBroom.  <br>See the [Bit Flags](#BitFlags) section for more information. |
| [NodePath](class_nodepath.md) | target\_destination | NodePath is intended as a targeting property type in map editors, similar to Quake's "target" property. Some map editors may have additional editor display options showing links between entities. Not utilized in every map editor. Returns a _String_ on map build. |
| [Material](class_material.md) | material / shader | Material is intended as a texture path property type in map editors. Some map editors may offer a texture picker. J.A.C.K. utilizes the _shader_ key word (make sure to set your [FuncGodotFGDFile's target\_map\_editor property](ref_fgd_resources.html#File) to _JACK_). Returns a _String_ on map build, using the assigned default Material's resource path as the property's value. |
| [Texture2D](class_texture2d.md) | decal | Texture2D is intended as a decal texture path property type in map editors. Some map editors may offer a texture picker, typically filtered to only access a _decals.wad_. In the map editor, the texture at the specified path will behave in a similar way to [Godot's Decal node](class_decal.md). Returns a _String_ on map build, using the assigned default Texture2D's resource path as the property's value. |
| [AudioStream](class_audiostream.md) | sound | AudioStream is intended as an audio file path property type in map editors. Some map editors may offer a sound picker. Returns a _String_ on map build, using the assigned default AudioStream's resource path as the property's value. |
| [Object](class_object.md) | target\_source | Object is intended as a target name property type in map editors, similar to Quake's "targetname" property. Some map editors may have additional editor display options showing links between entities. Not utilized in every map editor. Returns a _String_ on map build. |

  

## Choices

The **choices** key value type allows you to open a dropdown menu of predefined options in your map editor. They are defined in Godot by choosing a value type of dictionary, with each key being the option text and each value being the property value. Keys are always Strings, but values can be either Int or String.

![](./images/ref_kvp_choices1.png)

Normally the default value is set in Class Properties, but for Choices we can't do this (not without a fair amount of trouble). Instead we use Class Property Descriptions to set a default value. We do this by creating an Array with 2 elements: the first element is a String serving as the description; the second element is the default choice and should be either an Int or String matching one of the option values defined in Class Properties.

Once written to the FGD you should get a something like this in your map editor:

![](./images/ref_kvp_choices2.png)

> _NOTE: While Bool types always generate a choices key value type, you don't need to set them up any differently than any other property. FuncGodot will automatically format Bool types for you on FGD export._

  

## Bit Flags

Bit flags are the most complex key value type to set up, but offer a lot in simplifying complex comparisons and systems in your game scripts.

To set up a bit flags property, choose Array as the value's Variant type. Each element of the Array will be an Array as well, representing a single Flag. Each Flag Array is composed of 3 elements: a String serving as the Flag Description, an Int declaring the Flag's Bit Value, and an Int representing the Flag's default state.

Bit Flag properties do not utilize descriptions so there is no need to add one to the entity's Class Property Descriptions dictionary.

![](./images/ref_kvp_bitflags1.png)

Once exported, you should get something like this:

![](./images/ref_kvp_bitflags_tb.png) ![](./images/ref_kvp_bitflags_jack.png)

Left, Trenchbroom; Right, J.A.C.K.; Not shown: NetRadiant Custom because I'm lazy, but it's pretty similar to J.A.C.K. in this regard.

Even though Godot uses 64 bit signed integers, map editors only seem to offer support for up to 24 bit flags. This is largely an artifact of the Quake engine, specifically its Quake C programming language. QuakeC doesn't have an integer type and instead used a 32 bit floating point number. The result was that only 24 bits remained to be used in bitwise operations. The Half-Life engine inherited this limitation, and subsequent Quake and Valve map editors designed their bit flag menus with this limitation in mind.

In TrenchBroom this isn't too much of a problem as you can have multiple bit flag key value pairs. Unfortunately other map editors are designed to only support one group of flags that they assume to be **spawnflags**, no matter what they're called in the FGD. J.A.C.K. will just overwrite spawnflags. NetRadiant Custom will throw errors if it detects flag values with matching bits and be unable to open. All key value types of flags will be compiled into the entity's Flags property and saved in the map file with the key "spawnflags".

If you're using another map editor other than TrenchBroom, you can still use multiple flags key value pairs or inherit them across multiple Base Classes. Just make sure each flags property applied to an entity has a unique bit value and expect FuncGodot to build it as a compiled _spawnflags_ bitmask.

![](./images/ref_kvp_bitflags2.png)

## Build Stage Properties

In _Quake_ mapping there are a number of compiler only key value pairs that can alter the way the map is built, typically preceded by an underscore. These include properties like _\_phong_, _\_minlight_, and _\_shadow_.

_FuncGodot_ also has a few properties that can be used as part of the build process, all of which are customizable in the Map Settings resource. These properties are exposed by the FGD to be set in the map file and read by FuncGodot's core classes throughout the build stages. These build stage properties are:

|     |     |     |     |
| --- | --- | --- | --- |
| Map Settings Property | Default Key | Variant Type | Notes |
| Entity Name Property |     | [String](class_string.md) | Property used to rename nodes. The entity is renamed "entity\_" + entity\_name\_property. This can be overridden by the entity definition. |
| Entity Smoothing Property | \_phong | [Bool](class_bool.md) | Determines whether the _FuncGodotFGDSolidClass_ entity performs mesh smoothing operations. |
| Entity Smoothing Angle Property | \_phong\_angle | [Float](class_float.md) | The angular threshold that determines when a _FuncGodotFGDSolidClass_ entity's mesh vertices are smoothed. |
| Vertex Merge Distance Property | \_vertex\_merge\_distance | [Float](class_float.md) | Provides a snapping epsilon for vertices in a _FuncGodotFGDSolidClass_ entity's mesh. Adjusting this value can remove instances of gaps between polygon seams. |

  

Some of these properties have built-in support through the use of the default [FuncGodotFGDBaseClass](ref_fgd_resources.html#Base) resources _Phong_ and _VertexMergeDistance_.